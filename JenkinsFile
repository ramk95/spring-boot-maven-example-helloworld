pipeline {
    agent any
    stages{
        stage('build the app'){
            steps {
                sh "docker build -t build-${BUILD_NUMBER} ."
            }
        }

        stage('tagging the image'){
            steps {
                withCredentials(github_id-with-token){
                    sh "git tag build-${BUILD_NUMBER}"
                    sh "git push origin build-${BUILD_NUMBER}"
                }
            }
        }

        stage ('clean up dangling images'){
            steps{
                sh "docker system prune --all"
            }
        }
    }
}
